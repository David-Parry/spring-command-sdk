{
  "id": null,
  "uid": "qodo-springboot",
  "title": "Spring Boot (Micrometer) + Qodo MCP/WebSocket",
  "tags": ["spring-boot", "micrometer", "qodo", "mcp", "websocket"],
  "timezone": "browser",
  "schemaVersion": 38,
  "version": 1,
  "refresh": "10s",
  "__inputs": [
    {
      "name": "DS_PROMETHEUS",
      "label": "Prometheus",
      "description": "",
      "type": "datasource",
      "pluginId": "prometheus",
      "pluginName": "Prometheus"
    }
  ],
  "templating": {
    "list": [
      {
        "name": "application",
        "type": "query",
        "datasource": "Prometheus",
        "refresh": 2,
        "hide": 0,
        "label": "application",
        "query": "label_values(application)",
        "current": { "text": "command-sdk", "value": "command-sdk", "selected": true },
        "includeAll": false,
        "multi": false
      },
      {
        "name": "path",
        "type": "query",
        "datasource": "Prometheus",
        "refresh": 2,
        "hide": 0,
        "label": "disk path",
        "query": "label_values(disk_total_bytes{application=\"$application\"}, path)",
        "current": { "text": "/home/spring", "value": "/home/spring" },
        "includeAll": false,
        "multi": false
      }
    ]
  },
  "panels": [
    {
      "type": "stat",
      "title": "Application Started (s)",
      "gridPos": { "x": 0, "y": 0, "w": 6, "h": 4 },
      "targets": [
        {
          "expr": "application_started_time_seconds{application=\"$application\"}",
          "legendFormat": "started",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false }, "colorMode": "value", "graphMode": "none", "justifyMode": "auto" }
    },
    {
      "type": "stat",
      "title": "Application Ready (s)",
      "gridPos": { "x": 6, "y": 0, "w": 6, "h": 4 },
      "targets": [
        {
          "expr": "application_ready_time_seconds{application=\"$application\"}",
          "legendFormat": "ready",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "options": { "reduceOptions": { "calcs": ["lastNotNull"] }, "colorMode": "value", "graphMode": "none", "justifyMode": "auto" }
    },
    {
      "type": "gauge",
      "title": "Disk Used % (path=$path)",
      "gridPos": { "x": 12, "y": 0, "w": 12, "h": 4 },
      "targets": [
        {
          "expr": "100 - (100 * disk_free_bytes{application=\"$application\",path=\"$path\"} / disk_total_bytes{application=\"$application\",path=\"$path\"})",
          "legendFormat": "used %",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"] },
        "min": 0, "max": 100,
        "showThresholdLabels": false, "showThresholdMarkers": true
      },
      "fieldConfig": { "defaults": { "unit": "percent", "decimals": 1 } }
    },

    {
      "type": "timeseries",
      "title": "HTTP RPS (by uri)",
      "gridPos": { "x": 0, "y": 4, "w": 12, "h": 8 },
      "targets": [
        {
          "expr": "sum by (uri, method) (rate(http_server_requests_seconds_count{application=\"$application\"}[1m]))",
          "legendFormat": "{{method}} {{uri}}",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "req/s" } }
    },
    {
      "type": "timeseries",
      "title": "HTTP Avg Latency (by uri)",
      "gridPos": { "x": 12, "y": 4, "w": 12, "h": 8 },
      "targets": [
        {
          "expr": "sum by (uri, method) (rate(http_server_requests_seconds_sum{application=\"$application\"}[1m])) / sum by (uri, method) (rate(http_server_requests_seconds_count{application=\"$application\"}[1m]))",
          "legendFormat": "{{method}} {{uri}}",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "s", "decimals": 3 } }
    },

    {
      "type": "stat",
      "title": "HTTP Active Request Max (current)",
      "gridPos": { "x": 0, "y": 12, "w": 6, "h": 4 },
      "targets": [
        {
          "expr": "max(http_server_requests_active_seconds_max{application=\"$application\"})",
          "legendFormat": "active_seconds_max",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "s", "decimals": 3 } }
    },
    {
      "type": "stat",
      "title": "Process Uptime (s)",
      "gridPos": { "x": 6, "y": 12, "w": 6, "h": 4 },
      "targets": [
        {
          "expr": "process_uptime_seconds{application=\"$application\"}",
          "legendFormat": "uptime",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "s" } }
    },

    {
      "type": "timeseries",
      "title": "CPU Usage (process vs system)",
      "gridPos": { "x": 12, "y": 12, "w": 12, "h": 8 },
      "targets": [
        { "expr": "process_cpu_usage{application=\"$application\"}", "legendFormat": "process_cpu", "refId": "A", "datasource": "Prometheus" },
        { "expr": "system_cpu_usage{application=\"$application\"}", "legendFormat": "system_cpu", "refId": "B", "datasource": "Prometheus" }
      ],
      "fieldConfig": { "defaults": { "unit": "percentunit", "decimals": 3 } }
    },

    {
      "type": "timeseries",
      "title": "JVM Threads (live/daemon/peak)",
      "gridPos": { "x": 0, "y": 16, "w": 12, "h": 8 },
      "targets": [
        { "expr": "jvm_threads_live_threads{application=\"$application\"}", "legendFormat": "live", "refId": "A", "datasource": "Prometheus" },
        { "expr": "jvm_threads_daemon_threads{application=\"$application\"}", "legendFormat": "daemon", "refId": "B", "datasource": "Prometheus" },
        { "expr": "jvm_threads_peak_threads{application=\"$application\"}", "legendFormat": "peak", "refId": "C", "datasource": "Prometheus" }
      ]
    },
    {
      "type": "timeseries",
      "title": "JVM Memory Used (by area)",
      "gridPos": { "x": 12, "y": 16, "w": 12, "h": 8 },
      "targets": [
        { "expr": "sum by (area) (jvm_memory_used_bytes{application=\"$application\",area=\"heap\"})", "legendFormat": "heap", "refId": "A", "datasource": "Prometheus" },
        { "expr": "sum by (area) (jvm_memory_used_bytes{application=\"$application\",area=\"nonheap\"})", "legendFormat": "nonheap", "refId": "B", "datasource": "Prometheus" }
      ],
      "fieldConfig": { "defaults": { "unit": "bytes" } }
    },
    {
      "type": "timeseries",
      "title": "GC Pause (rate over 5m) & Overhead",
      "gridPos": { "x": 0, "y": 24, "w": 12, "h": 8 },
      "targets": [
        { "expr": "rate(jvm_gc_pause_seconds_sum{application=\"$application\"}[5m])", "legendFormat": "pause_s/s", "refId": "A", "datasource": "Prometheus" },
        { "expr": "jvm_gc_overhead{application=\"$application\"}", "legendFormat": "overhead (0..1)", "refId": "B", "datasource": "Prometheus" }
      ],
      "fieldConfig": { "defaults": { "unit": "s" } }
    },

    {
      "type": "stat",
      "title": "Qodo MCP Active Servers",
      "gridPos": { "x": 12, "y": 24, "w": 6, "h": 4 },
      "targets": [
        { "expr": "qodo_mcp_active_servers{application=\"$application\"}", "refId": "A", "datasource": "Prometheus" }
      ]
    },
    {
      "type": "timeseries",
      "title": "Qodo MCP Tool Invocations /s (by tool)",
      "gridPos": { "x": 18, "y": 24, "w": 6, "h": 8 },
      "targets": [
        {
          "expr": "sum by (tool) (rate(qodo_mcp_tool_invocations_total{application=\"$application\"}[1m]))",
          "legendFormat": "{{tool}}",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "ops" } }
    },
    {
      "type": "timeseries",
      "title": "Qodo MCP Avg Exec Time (s) by tool",
      "gridPos": { "x": 0, "y": 32, "w": 12, "h": 8 },
      "targets": [
        {
          "expr": "sum by (tool) (rate(qodo_mcp_tool_execution_time_seconds_sum{application=\"$application\"}[5m])) / sum by (tool) (rate(qodo_mcp_tool_execution_time_seconds_count{application=\"$application\"}[5m]))",
          "legendFormat": "{{tool}}",
          "refId": "A",
          "datasource": "Prometheus"
        }
      ],
      "fieldConfig": { "defaults": { "unit": "s", "decimals": 3 } }
    },

    {
      "type": "stat",
      "title": "WebSocket Active Connections",
      "gridPos": { "x": 12, "y": 32, "w": 6, "h": 4 },
      "targets": [
        { "expr": "qodo_ws_active_connections{application=\"$application\"}", "refId": "A", "datasource": "Prometheus" }
      ]
    },
    {
      "type": "timeseries",
      "title": "WebSocket Msgs /s (received/sent by instance)",
      "gridPos": { "x": 18, "y": 32, "w": 6, "h": 8 },
      "targets": [
        { "expr": "sum by (instance) (rate(qodo_ws_messages_received_total{application=\"$application\"}[1m]))", "legendFormat": "recv {{instance}}", "refId": "A", "datasource": "Prometheus" },
        { "expr": "sum by (instance) (rate(qodo_ws_messages_sent_total{application=\"$application\"}[1m]))", "legendFormat": "sent {{instance}}", "refId": "B", "datasource": "Prometheus" }
      ],
      "fieldConfig": { "defaults": { "unit": "ops" } }
    },
    {
      "type": "timeseries",
      "title": "WebSocket Last Pong Age (s) by instance",
      "gridPos": { "x": 0, "y": 40, "w": 12, "h": 8 },
      "targets": [
        { "expr": "qodo_ws_last_pong_age_seconds{application=\"$application\"}", "legendFormat": "{{instance}}", "refId": "A", "datasource": "Prometheus" }
      ],
      "fieldConfig": { "defaults": { "unit": "s", "decimals": 3 } }
    },
    {
      "type": "timeseries",
      "title": "WebSocket READY Signals & Abnormal Closes",
      "gridPos": { "x": 12, "y": 40, "w": 12, "h": 8 },
      "targets": [
        { "expr": "rate(qodo_ws_ready_signal_received_total{application=\"$application\"}[5m])", "legendFormat": "ready/s", "refId": "A", "datasource": "Prometheus" },
        { "expr": "rate(qodo_ws_abnormal_closes_total{application=\"$application\"}[5m])", "legendFormat": "abnormal_closes/s", "refId": "B", "datasource": "Prometheus" }
      ]
    }
  ]
}